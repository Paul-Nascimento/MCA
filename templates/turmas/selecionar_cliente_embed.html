<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Selecionar Cliente</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-3">

  <h5 class="mb-3">
    Selecionar cliente — {{ turma.modalidade.nome }} ({{ turma.condominio.nome }})
    <small class="text-muted">• {{ turma.hora_inicio|time:"H:i" }}</small>
  </h5>

  <form method="post" action="{% url 'turmas:matricular' %}" class="card">
    {% csrf_token %}
    <input type="hidden" name="turma_id" value="{{ turma.id }}">
    <!-- manter retorno para reabrir o embed após a matrícula, se desejar -->
    <input type="hidden" name="next"
           value="{% url 'turmas:selecionar_cliente' turma.id %}?embed=1">

    <div class="card-body">
      <div class="row g-3">

        <!-- SELECT DE CLIENTES DO CONDOMÍNIO -->
        <div class="col-12">
          <label class="form-label">Cliente do condomínio</label>
          <select name="cliente" class="form-select" required>
            <option value="">Selecione…</option>
            {% for cli in clientes %}
              <option value="{{ cli.id }}">{{ cli.nome_razao }} — {{ cli.cpf_cnpj }}</option>
            {% endfor %}
          </select>
          <div class="form-text">A lista já está filtrada pelo condomínio da turma.</div>
        </div>

        <!-- DATA DE INÍCIO -->
        <div class="col-sm-6 col-md-4">
          <label class="form-label">Data de início</label>
          <input type="date" name="data_inicio" value="{{ hoje|date:'Y-m-d' }}" class="form-control" required>
        </div>

        <!-- É O PRÓPRIO CLIENTE -->
        <div class="col-12">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="chkProprioAluno" checked>
            <label class="form-check-label" for="chkProprioAluno">É o próprio cliente</label>
          </div>
          <div class="form-text">Desmarque para cadastrar um participante/dependente.</div>
        </div>

        <!-- CAMPOS DO PARTICIPANTE -->
        <div id="participanteFields" class="row g-3" style="display:none;">
          <div class="col-md-6">
            <label class="form-label">Participante — Nome</label>
            <input name="participante_nome" class="form-control" placeholder="Nome do participante">
          </div>
          <div class="col-md-4">
            <label class="form-label">Participante — CPF</label>
            <input name="participante_cpf" class="form-control" placeholder="Somente dígitos">
          </div>
          <div class="col-md-2">
            <label class="form-label">Sexo</label>
            <select name="participante_sexo" class="form-select">
              <option value="">--</option>
              <option value="M">M</option>
              <option value="F">F</option>
              <option value="O">Outro</option>
            </select>
          </div>
        </div>

      </div>
    </div>

    <div class="card-footer d-flex justify-content-end gap-2">
      <button type="button" class="btn btn-secondary" onclick="window.history.back();">Cancelar</button>
      <button type="submit" class="btn btn-success">Matricular</button>
    </div>
  </form>

  <script>
    (function(){
      const chk = document.getElementById('chkProprioAluno');
      const part = document.getElementById('participanteFields');
      function toggle(){ part.style.display = chk.checked ? 'none' : ''; }
      chk.addEventListener('change', toggle);
      toggle();
    })();
  </script>
</body>
</html>
