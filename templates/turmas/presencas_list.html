{% extends "base.html" %}
{% block title %}Listas de Presença | MCA{% endblock %}
{% block content %}

{% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-1">Listas de Presença — {{ turma.modalidade.nome }} / {{ turma.condominio.nome }}</h4>
    <div class="text-muted">
      Professor: <strong>{{ turma.professor.nome }}</strong> ·
      <span class="me-2">
        {% if turma.seg %}<span class="badge text-bg-secondary">Seg</span>{% endif %}
        {% if turma.ter %}<span class="badge text-bg-secondary">Ter</span>{% endif %}
        {% if turma.qua %}<span class="badge text-bg-secondary">Qua</span>{% endif %}
        {% if turma.qui %}<span class="badge text-bg-secondary">Qui</span>{% endif %}
        {% if turma.sex %}<span class="badge text-bg-secondary">Sex</span>{% endif %}
        {% if turma.sab %}<span class="badge text-bg-secondary">Sáb</span>{% endif %}
        {% if turma.dom %}<span class="badge text-bg-secondary">Dom</span>{% endif %}
      </span>
      {{ turma.hora_inicio|time:"H:i" }} ·
      Vigência: {{ turma.inicio_vigencia|date:"d/m/Y" }}{% if turma.fim_vigencia %} a {{ turma.fim_vigencia|date:"d/m/Y" }}{% else %} (sem fim){% endif %}
    </div>
  </div>
  <a class="btn btn-outline-secondary" href="{% url 'turmas:presencas_turma' turma_id=turma.id %}">
    <i class="fa-solid fa-rotate"></i> Atualizar
  </a>
</div>

<form method="get" class="card card-body mb-3">
  <div class="row g-2 align-items-end">
    <div class="col-md-3">
      <label class="form-label">De</label>
      <input type="date" name="data_de" value="{{ filtro.initial.data_de }}" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label">Até</label>
      <input type="date" name="data_ate" value="{{ filtro.initial.data_ate }}" class="form-control">
    </div>
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary" type="submit">
        <i class="fa-solid fa-magnifying-glass"></i> Filtrar
      </button>
    </div>
  </div>
</form>

<div class="card">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Data</th>
          <th>Presentes</th>
          <th>Total itens</th>
          <th>Observação</th>
          <th style="width: 120px;">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for l in listas %}
        <tr>
          <td>{{ l.data|date:"d/m/Y" }}</td>
          <td>
            <span class="badge text-bg-{% if l.total_itens_count and l.total_presentes_count == l.total_itens_count %}success{% else %}primary{% endif %}">
              {{ l.total_presentes_count|default:0 }}
            </span>
          </td>
          <td>{{ l.total_itens_count|default:0 }}</td>
          <td class="text-truncate" style="max-width: 420px;">{{ l.observacao_geral }}</td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="{% url 'turmas:presenca_detalhe' l.id %}">
              <i class="fa-solid fa-clipboard-check"></i> Abrir
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center py-4">Nenhuma lista encontrada.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
