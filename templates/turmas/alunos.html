{% extends "base.html" %}
{% block title %}Alunos da Turma | MCA{% endblock %}
{% block content %}

{% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-1">
      {{ turma.modalidade.nome }} — {{ turma.condominio.nome }}
    </h4>
    <div class="text-muted">
      Professor: <strong>{{ turma.professor.nome }}</strong> ·
      {{ turma.get_dia_semana_display }} {{ turma.hora_inicio|time:"H:i" }} ·
      Capacidade: {{ turma.capacidade }} ·
      Ocupação: {{ ocupacao }}
    </div>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-dark" href="{% url 'turmas:presencas_turma' turma_id=turma.id %}">
      <i class="fa-solid fa-clipboard-list"></i> Presenças
    </a>
    <a class="btn btn-outline-secondary" href="{% url 'turmas:list' %}">
      <i class="fa-solid fa-arrow-left"></i> Voltar
    </a>
  </div>
</div>

<div class="card">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Cliente</th>
          <th>CPF/CNPJ</th>
          <th>Início</th>
          <th>Fim</th>
          <th>Status</th>
          <th style="width: 120px;">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for m in matriculas %}
        <tr>
          <td>{{ m.cliente.nome_razao }}</td>
          <td>{{ m.cliente.cpf_cnpj }}</td>
          <td>{{ m.data_inicio|date:"d/m/Y" }}</td>
          <td>{{ m.data_fim|date:"d/m/Y" }}</td>
          <td>
            {% if m.ativa %}
              <span class="badge text-bg-success">Ativa</span>
            {% else %}
              <span class="badge text-bg-secondary">Inativa</span>
            {% endif %}
          </td>
          <td>
            {% if m.ativa %}
            <form method="post" action="{% url 'turmas:encerrar_matricula' m.id %}" onsubmit="return confirm('Encerrar matrícula deste aluno?');">
              {% csrf_token %}
              <input type="hidden" name="turma_id" value="{{ turma.id }}">
              <button class="btn btn-sm btn-outline-danger">
                <i class="fa-solid fa-user-xmark"></i> Encerrar
              </button>
            </form>
            {% else %}
              <button class="btn btn-sm btn-outline-secondary" disabled>—</button>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-center py-4">Nenhuma matrícula.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
